==============================================================================
ðŸ“¦ REGLAS DE SEGURIDAD PARA FIREBASE STORAGE
==============================================================================

âš ï¸ ERROR ACTUAL: "User does not have permission to access this object"

CAUSA: Las reglas de Firebase Storage estÃ¡n bloqueando el acceso.

==============================================================================
ðŸ”§ SOLUCIÃ“N: Copiar estas reglas en Firebase Console
==============================================================================

1. Ir a: https://console.firebase.google.com/
2. Seleccionar proyecto: "iot-proyecto-f817d"
3. Navegar a: Storage > Rules
4. REEMPLAZAR las reglas existentes con las siguientes:

----------------------------------------------------------------------------
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Permitir lectura pÃºblica de imÃ¡genes de tours publicados
    match /tour_images/{empresaId}/publicados/{tourId}/{imageName} {
      allow read: if true; // Cualquiera puede ver tours publicados
      allow write: if request.auth != null && 
                      request.auth.uid == empresaId; // Solo la empresa puede escribir
    }
    
    // ImÃ¡genes de borradores - solo la empresa propietaria
    match /tour_images/{empresaId}/borradores/{tourId}/{imageName} {
      allow read, write: if request.auth != null && 
                            request.auth.uid == empresaId;
    }
    
    // Fotos de perfil de usuarios
    match /profile_photos/{userId}/{imageName} {
      allow read: if true; // Cualquiera puede ver fotos de perfil
      allow write: if request.auth != null && 
                      request.auth.uid == userId;
    }
    
    // Fotos promocionales de empresas
    match /empresa_photos/{empresaId}/{imageName} {
      allow read: if true; // Cualquiera puede ver fotos de empresas
      allow write: if request.auth != null && 
                      request.auth.uid == empresaId;
    }
    
    // Bloquear acceso a cualquier otra ruta
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
----------------------------------------------------------------------------

==============================================================================
ðŸ” EXPLICACIÃ“N DE LAS REGLAS
==============================================================================

1. **Tours Publicados** (/tour_images/{empresaId}/publicados/)
   - LECTURA: PÃºblica (cualquier usuario puede ver)
   - ESCRITURA: Solo la empresa propietaria (request.auth.uid == empresaId)

2. **Borradores de Tours** (/tour_images/{empresaId}/borradores/)
   - LECTURA/ESCRITURA: Solo la empresa propietaria
   - Protege borradores que aÃºn no estÃ¡n listos para publicar

3. **Fotos de Perfil** (/profile_photos/{userId}/)
   - LECTURA: PÃºblica
   - ESCRITURA: Solo el usuario propietario

4. **Fotos de Empresas** (/empresa_photos/{empresaId}/)
   - LECTURA: PÃºblica
   - ESCRITURA: Solo la empresa propietaria

5. **Otras Rutas**
   - BLOQUEADAS por seguridad

==============================================================================
âœ… PASOS PARA APLICAR
==============================================================================

1. Abrir Firebase Console
2. Storage > Rules
3. Copiar y pegar las reglas de arriba
4. Click en "Publicar"
5. Esperar ~30 segundos para que se propaguen los cambios
6. Volver a la app y probar guardar/publicar tour

==============================================================================
ðŸ§ª VERIFICACIÃ“N
==============================================================================

DespuÃ©s de aplicar las reglas, intenta:

1. Crear un tour nuevo
2. Seleccionar 1-3 imÃ¡genes
3. Guardar como borrador
4. Verificar en Logcat:
   âœ“ "Imagen subida exitosamente: [URL]"
   âœ— Si aÃºn falla: Verificar que las reglas se aplicaron correctamente

==============================================================================
ðŸ“± PERMISOS DE ANDROID REQUERIDOS
==============================================================================

Ya estÃ¡n configurados en AndroidManifest.xml:
âœ… READ_EXTERNAL_STORAGE (lÃ­nea 15)
âœ… POST_NOTIFICATIONS (lÃ­nea 20)

==============================================================================
ðŸ”— RECURSOS ADICIONALES
==============================================================================

- Docs: https://firebase.google.com/docs/storage/security
- Console: https://console.firebase.google.com/project/iot-proyecto-f817d/storage

==============================================================================
